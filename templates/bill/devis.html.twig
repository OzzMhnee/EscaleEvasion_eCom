{% block title %}Devis du séjour{% endblock %}

{% block body %}
<style>
    .devis-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 2rem;
    }
    .devis-logo {
        width: 140px;
        height: auto;
    }
    .devis-title {
        font-size: 2rem;
        font-weight: bold;
        color: #222;
        text-align: right;
    }
    .devis-section-title {
        color: #0d6efd;
        font-size: 1.1rem;
        margin-top: 2rem;
        margin-bottom: 0.5rem;
        font-weight: bold;
    }
    .devis-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 1.5rem;
    }
    .devis-table th, .devis-table td {
        border: 1px solid #bbb;
        padding: 8px 12px;
        text-align: left;
    }
    .devis-table thead {
        background: #f2f2f2;
    }
    .devis-table tbody tr:nth-child(odd){
        background: #f9f9f9;
    }
    .devis-summary {
        margin-top: 2rem;
        font-size: 1.1rem;
    }
    .devis-nota {
        margin-top: 2.5rem;
        background: #fff3cd;
        border: 1px solid #ffeeba;
        color: #856404;
        padding: 1.2rem 1.5rem;
        border-radius: 6px;
        font-size: 1.05rem;
    }
</style>

<div class="container">
    <div class="devis-header">
        <div>
            {# <img src="file:///{{ (project_dir ~ '/public/img/GrandLogoDark.png')|replace({'\\':'/'}) }}" alt="Logo Escale Evasion" class="devis-logo"> #}
        </div>
        <div class="devis-title">
            Devis de location saisonnière<br>
            <span style="font-size:1.1rem; color:#666;">N° {{ reservation.id }}</span>
        </div>
    </div>
    <div>
        <strong>Date d'édition :</strong> {{ "now"|date('d/m/Y') }}<br>
        <strong>Date de la demande :</strong> {{ reservation.createdAt|date('d/m/Y') }}
    </div>

    <div class="devis-section-title">Coordonnées du client</div>
    <table class="devis-table">
        <thead>
            <tr>
                <th>Nom</th>
                <th>Prénom</th>
                <th>Email</th>
                {# <th>Téléphone</th> #}
                {# <th>Adresse</th> #}
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>{{ reservation.user.lastName }}</td>
                <td>{{ reservation.user.firstName }}</td>
                <td>{{ reservation.user.email }}</td>
                {# <td>{{ reservation.user.phone }}</td> #}
                {# <td>{{ reservation.user.address }}</td> #}
            </tr>
        </tbody>
    </table>

    <div class="devis-section-title">Détails de la réservation</div>
    <table class="devis-table">
        <thead>
            <tr>
                <th>Logement</th>
                <th>Adresse</th>
                <th>Dates du séjour</th>
                <th>Nombre de nuits</th>
                <th>Prix par nuit</th>
                <th>Montant de l'acompte (10%)</th>
                <th>Taxe de séjour (5%)</th>
                <th>Total séjour</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>{{ reservation.product.name }}</td>
                <td>{{ reservation.product.city }}</td>
                <td>
                    du {{ reservation.startDate|date('d/m/Y') }}<br>
                    au {{ reservation.endDate|date('d/m/Y') }}
                </td>
                {% set nights = (reservation.endDate|date('U') - reservation.startDate|date('U')) // 86400 %}
                <td>{{ nights }}</td>
                <td>{{ reservation.product.price }} €</td>
                {% set acompte = (reservation.product.price * nights * 0.10)|round(2, 'floor') %}
                <td>{{ acompte }} €</td>
                {% set taxe = (reservation.product.price * nights * 0.05)|round(2, 'floor') %}
                <td>{{ taxe }} €</td>
                {% set total = reservation.product.price * nights + taxe %}
                <td>{{ total }} €</td>
            </tr>
        </tbody>
    </table>

    <div class="devis-summary">
        <strong>Acompte à verser pour valider la réservation :</strong> {{ acompte }} €<br>
        <strong>Total à payer pour le séjour :</strong> {{ total }} €
    </div>

    <div class="devis-nota">
        <strong>Nota importante :</strong><br>
        Ce devis est valable <strong>24 heures</strong> à compter de son édition. Passé ce délai, les dates sélectionnées seront automatiquement remises à disposition d'autres clients.<br>
        <strong>La réservation ne sera effective qu'après réception de l'acompte dans le délai imparti.</strong><br>
        Les tarifs indiqués sont susceptibles d'être modifiés en cas de non-respect du délai de versement de l'acompte.<br>
        <em>Merci de nous contacter pour toute question ou précision concernant ce devis.</em>
    </div>
</div>
{% endblock %}